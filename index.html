<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미팅 노트 - 완전한 기능</title>
    <link rel="manifest" href="/public/manifest.json">
    <meta name="theme-color" content="#0F62FE">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .parse-textarea {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #0F62FE;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        .camera-view {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: black;
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }
        .photo-preview {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // 로컬 스토리지 관리 함수들
        const StorageManager = {
            MEETINGS_KEY: 'field-meeting-data',
            TEMPLATES_KEY: 'field-meeting-templates',
            
            saveMeetings: (meetings) => {
                try {
                    localStorage.setItem(StorageManager.MEETINGS_KEY, JSON.stringify(meetings));
                } catch (error) {
                    console.error('Failed to save meetings:', error);
                }
            },
            
            loadMeetings: () => {
                try {
                    const data = localStorage.getItem(StorageManager.MEETINGS_KEY);
                    return data ? JSON.parse(data) : initialMeetings;
                } catch (error) {
                    console.error('Failed to load meetings:', error);
                    return initialMeetings;
                }
            },
            
            saveTemplates: (templates) => {
                try {
                    localStorage.setItem(StorageManager.TEMPLATES_KEY, JSON.stringify(templates));
                } catch (error) {
                    console.error('Failed to save templates:', error);
                }
            },
            
            loadTemplates: () => {
                try {
                    const data = localStorage.getItem(StorageManager.TEMPLATES_KEY);
                    return data ? JSON.parse(data) : defaultTemplates;
                } catch (error) {
                    console.error('Failed to load templates:', error);
                    return defaultTemplates;
                }
            }
        };

        // PWA 설치 관리
        const PWAManager = {
            deferredPrompt: null,
            
            init: () => {
                // 서비스 워커 등록
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js')
                        .then((registration) => {
                            console.log('Service Worker 등록 성공:', registration);
                        })
                        .catch((error) => {
                            console.log('Service Worker 등록 실패:', error);
                        });
                }

                // PWA 설치 프롬프트 처리
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    PWAManager.deferredPrompt = e;
                });
            },
            
            install: async () => {
                if (PWAManager.deferredPrompt) {
                    PWAManager.deferredPrompt.prompt();
                    const { outcome } = await PWAManager.deferredPrompt.userChoice;
                    PWAManager.deferredPrompt = null;
                    return outcome === 'accepted';
                }
                return false;
            }
        };

        // 사진 관리
        const PhotoManager = {
            takePhoto: async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'environment' } 
                    });
                    return stream;
                } catch (error) {
                    console.error('Camera access failed:', error);
                    return null;
                }
            },
            
            captureFrame: (video) => {
                const canvas = document.createElement('canvas');
                canvas.width = 1920;
                canvas.height = 1080;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                return canvas.toDataURL('image/jpeg', 0.9);
            },
            
            resizeImage: (dataUrl, maxWidth = 800) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
                        canvas.width = img.width * ratio;
                        canvas.height = img.height * ratio;
                        
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.8));
                    };
                    img.src = dataUrl;
                });
            }
        };
        
        // 매물 정보 파싱 함수
        function parsePropertyInfo(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            let result = {
                name: '',
                address: '',
                rent: '',
                area_sqm: '',
                area_pyeong: '',
                rooms: '',
                bathrooms: '',
                direction: '',
                building: '',
                floor: '',
                totalFloor: '',
                notes: '',
                contact: '',
                contactType: '부동산',
                agencyName: ''
            };
            
            lines.forEach((line, index) => {
                if (index === 0) {
                    const match = line.match(/^➡️?(.+?)\s*\((.+?)\)/);
                    if (match) {
                        result.name = match[1].trim();
                        result.address = match[2].trim();
                    } else {
                        result.name = line.replace(/^➡️/, '').trim();
                    }
                }
                else if (index === 1 && line.includes('전세')) {
                    const rentMatch = line.match(/전세:\s*(.+)/);
                    if (rentMatch) {
                        result.rent = rentMatch[1].trim();
                    }
                }
                else if (index === 2 && line.includes('정  보')) {
                    const infoMatch = line.match(/정\s*보:\s*(.+)/);
                    if (infoMatch) {
                        const info = infoMatch[1];
                        const areaMatch = info.match(/(\d+\.?\d*)㎡\s*\(~?(\d+\.?\d*)평\)/);
                        if (areaMatch) {
                            result.area_sqm = areaMatch[1];
                            result.area_pyeong = areaMatch[2];
                        }
                        const roomMatch = info.match(/방\s*(\d+)개/);
                        const bathMatch = info.match(/욕실\s*(\d+)개/);
                        if (roomMatch) result.rooms = roomMatch[1];
                        if (bathMatch) result.bathrooms = bathMatch[1];
                    }
                }
                else if (index === 3 && line.includes('특  징')) {
                    const featureMatch = line.match(/특\s*징:\s*(.+)/);
                    if (featureMatch) {
                        const features = featureMatch[1];
                        const directionMatch = features.match(/(남향|북향|동향|서향|남동향|남서향|북동향|북서향)/);
                        if (directionMatch) result.direction = directionMatch[1];
                        const buildingMatch = features.match(/(\d+)동/);
                        if (buildingMatch) result.building = buildingMatch[1] + '동';
                        const floorMatch = features.match(/(\d+)층\/총(\d+)층/);
                        if (floorMatch) {
                            result.floor = floorMatch[1] + '층';
                            result.totalFloor = floorMatch[2] + '층';
                        }
                    }
                }
                else if (index === 4 && line.includes('공개비고')) {
                    const notesMatch = line.match(/공개비고:\s*(.+)/);
                    if (notesMatch) {
                        result.notes = notesMatch[1].trim();
                    }
                }
                else if (index === 5 && line.includes('문  의')) {
                    const contactMatch = line.match(/문\s*의:\s*(.+?)\s*\((.+?)\)/);
                    if (contactMatch) {
                        result.agencyName = contactMatch[1].trim();
                        result.contact = contactMatch[2].trim();
                        result.contactType = '부동산';
                    }
                }
            });
            
            return result;
        }
        
        // 초기 목업 데이터
        const initialMeetings = [
            {
                id: '1',
                customerName: '김철수',
                date: '2024-09-06',
                purpose: '전세',
                status: '진행중',
                properties: [
                    {
                        id: 'prop_1',
                        name: '대림아르빌',
                        address: '등촌동 637-22',
                        area_sqm: 84.60,
                        area_pyeong: 25.6,
                        rooms: '3',
                        bathrooms: '2',
                        direction: '남향',
                        building: '101동',
                        floor: '9층',
                        totalFloor: '9층',
                        visitTime: '14:00',
                        contact: '02-3665-5466',
                        contactType: '부동산',
                        agencyName: '우리대동공인중개사사무소',
                        status: '볼수있음',
                        rent: '전세 4억 8,000만 원',
                        notes: ['깨끗', '남향', '10월말'],
                        customerReaction: '',
                        photos: []
                    }
                ]
            }
        ];

        // 기본 문자 템플릿
        const defaultTemplates = [
            { id: 1, name: '방문 예정 알림', message: '안녕하세요. OOO부동산입니다. 잠시 후 방문 예정이니 확인 부탁드립니다.' },
            { id: 2, name: '도착 알림', message: '안녕하세요. 매물 앞에 도착했습니다.' },
            { id: 3, name: '일정 변경', message: '죄송합니다. 급한 일이 생겨 방문 시간이 조금 늦어질 예정입니다.' },
            { id: 4, name: '미팅 완료', message: '오늘 미팅 감사했습니다. 곧 보고서를 보내드리겠습니다.' }
        ];
        
        // 메인 앱 컴포넌트
        function App() {
            const [currentView, setCurrentView] = useState('list');
            const [selectedMeetingId, setSelectedMeetingId] = useState(null);
            const [meetings, setMeetings] = useState([]);
            const [messageTemplates, setMessageTemplates] = useState([]);
            const [isEditing, setIsEditing] = useState(false);
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            
            // 데이터 로드
            useEffect(() => {
                const loadedMeetings = StorageManager.loadMeetings();
                const loadedTemplates = StorageManager.loadTemplates();
                setMeetings(loadedMeetings);
                setMessageTemplates(loadedTemplates);
                
                // PWA 초기화
                PWAManager.init();
                
                // 설치 프롬프트 체크
                window.addEventListener('beforeinstallprompt', () => {
                    setShowInstallPrompt(true);
                });
            }, []);
            
            // 미팅 데이터 변경 시 저장
            useEffect(() => {
                if (meetings.length > 0) {
                    StorageManager.saveMeetings(meetings);
                }
            }, [meetings]);
            
            // 템플릿 데이터 변경 시 저장
            useEffect(() => {
                if (messageTemplates.length > 0) {
                    StorageManager.saveTemplates(messageTemplates);
                }
            }, [messageTemplates]);
            
            const handleMeetingClick = (meetingId) => {
                setSelectedMeetingId(meetingId);
                setCurrentView('detail');
                setIsEditing(false);
            };
            
            const handleNewMeeting = () => {
                setSelectedMeetingId('new');
                setCurrentView('edit');
                setIsEditing(true);
            };
            
            const handleEdit = () => {
                setCurrentView('edit');
                setIsEditing(true);
            };
            
            const handleBackToList = () => {
                setCurrentView('list');
                setSelectedMeetingId(null);
                setIsEditing(false);
            };
            
            const handleBackToDetail = () => {
                setCurrentView('detail');
                setIsEditing(false);
            };
            
            const handleSaveMeeting = (meetingData) => {
                if (selectedMeetingId === 'new') {
                    const newId = Date.now().toString();
                    const newMeeting = { ...meetingData, id: newId };
                    setMeetings([...meetings, newMeeting]);
                    setSelectedMeetingId(newId);
                } else {
                    setMeetings(meetings.map(m => 
                        m.id === selectedMeetingId ? { ...meetingData, id: selectedMeetingId } : m
                    ));
                }
                setCurrentView('detail');
                setIsEditing(false);
            };
            
            const handleUpdateMeeting = (updatedMeeting) => {
                setMeetings(meetings.map(m => 
                    m.id === updatedMeeting.id ? updatedMeeting : m
                ));
            };

            const handleInstallApp = async () => {
                const installed = await PWAManager.install();
                if (installed) {
                    setShowInstallPrompt(false);
                }
            };
            
            if (currentView === 'edit') {
                return <MeetingEdit 
                    meetingId={selectedMeetingId}
                    meeting={selectedMeetingId === 'new' ? null : meetings.find(m => m.id === selectedMeetingId)}
                    onSave={handleSaveMeeting}
                    onBack={selectedMeetingId === 'new' ? handleBackToList : handleBackToDetail}
                />;
            }
            
            if (currentView === 'detail') {
                return <MeetingDetail 
                    meetingId={selectedMeetingId} 
                    meeting={meetings.find(m => m.id === selectedMeetingId)}
                    onBack={handleBackToList}
                    onEdit={handleEdit}
                    onUpdate={handleUpdateMeeting}
                    messageTemplates={messageTemplates}
                    onUpdateTemplates={setMessageTemplates}
                />;
            }
            
            return (
                <>
                    <MeetingList 
                        meetings={meetings}
                        onMeetingClick={handleMeetingClick} 
                        onNewMeeting={handleNewMeeting}
                    />
                    {showInstallPrompt && (
                        <div className="install-prompt">
                            <div className="flex items-center justify-between">
                                <span className="mr-4">앱을 홈 화면에 설치하시겠습니까?</span>
                                <div>
                                    <button 
                                        onClick={handleInstallApp}
                                        className="bg-white text-blue-600 px-3 py-1 rounded mr-2 text-sm font-medium"
                                    >
                                        설치
                                    </button>
                                    <button 
                                        onClick={() => setShowInstallPrompt(false)}
                                        className="text-blue-100 text-sm"
                                    >
                                        나중에
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }
        
        // 미팅 리스트 컴포넌트 (기존과 동일)
        function MeetingList({ meetings, onMeetingClick, onNewMeeting }) {
            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return `${date.getMonth() + 1}월 ${date.getDate()}일`;
            };

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen">
                    <div className="flex items-center justify-between p-4 border-b border-gray-100">
                        <h1 className="text-xl font-semibold text-gray-800">미팅 노트</h1>
                        <button 
                            onClick={onNewMeeting}
                            className="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-semibold hover:bg-blue-700"
                        >
                            +
                        </button>
                    </div>

                    <div className="p-4 space-y-3">
                        {meetings.length === 0 ? (
                            <div className="text-center py-12 text-gray-400">
                                <p>등록된 미팅이 없습니다</p>
                                <p className="text-sm mt-1">+ 버튼을 눌러 새 미팅을 추가하세요</p>
                            </div>
                        ) : (
                            meetings.map((meeting) => (
                                <div 
                                    key={meeting.id} 
                                    className="bg-gray-50 rounded-lg p-4 border border-gray-100 hover:shadow-sm transition-shadow cursor-pointer"
                                    onClick={() => onMeetingClick(meeting.id)}
                                >
                                    <div className="flex items-start justify-between mb-2">
                                        <div className="flex items-center space-x-2">
                                            <span className="text-sm text-gray-500">
                                                {formatDate(meeting.date)}
                                            </span>
                                            <span className="text-gray-400">•</span>
                                            <span className="font-medium text-gray-800">
                                                {meeting.customerName}님
                                            </span>
                                        </div>
                                        <span className={`px-2 py-1 text-xs rounded-full ${
                                            meeting.status === '진행중' 
                                                ? 'bg-orange-500 text-white' 
                                                : 'bg-gray-200 text-gray-600'
                                        }`}>
                                            {meeting.status}
                                        </span>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2 text-sm text-gray-500">
                                        <span>{meeting.purpose}</span>
                                        <span>•</span>
                                        <span>{meeting.properties.length}개 매물</span>
                                    </div>
                                    
                                    <div className="mt-2 text-sm text-gray-500">
                                        {meeting.properties.slice(0, 2).map((prop, index) => (
                                            <span key={index}>
                                                {prop.name} {prop.area_pyeong}평
                                                {index < Math.min(meeting.properties.length - 1, 1) && ', '}
                                            </span>
                                        ))}
                                        {meeting.properties.length > 2 && (
                                            <span> 외 {meeting.properties.length - 2}곳</span>
                                        )}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        }

        // 카메라 컴포넌트
        function CameraView({ onCapture, onClose }) {
            const videoRef = useRef(null);
            const [stream, setStream] = useState(null);

            useEffect(() => {
                const startCamera = async () => {
                    const mediaStream = await PhotoManager.takePhoto();
                    if (mediaStream) {
                        setStream(mediaStream);
                        if (videoRef.current) {
                            videoRef.current.srcObject = mediaStream;
                        }
                    }
                };
                startCamera();

                return () => {
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                };
            }, []);

            const handleCapture = () => {
                if (videoRef.current) {
                    const photoData = PhotoManager.captureFrame(videoRef.current);
                    onCapture(photoData);
                }
            };

            return (
                <div className="camera-view">
                    <div className="flex items-center justify-between p-4 text-white">
                        <button onClick={onClose} className="text-xl">✕</button>
                        <h2 className="text-lg font-semibold">매물 촬영</h2>
                        <div></div>
                    </div>
                    
                    <div className="flex-1 relative">
                        <video 
                            ref={videoRef}
                            autoPlay 
                            playsInline 
                            className="w-full h-full object-cover"
                        />
                    </div>
                    
                    <div className="p-6 flex justify-center">
                        <button
                            onClick={handleCapture}
                            className="w-16 h-16 bg-white rounded-full border-4 border-gray-300 flex items-center justify-center"
                        >
                            <div className="w-12 h-12 bg-white rounded-full shadow-lg"></div>
                        </button>
                    </div>
                </div>
            );
        }

        // PropertyPasteModal 컴포넌트
        function PropertyPasteModal({ onClose, onParse }) {
            const [pasteText, setPasteText] = useState('');
            const [previewData, setPreviewData] = useState(null);
            
            const sampleText = `➡️대림아르빌 (등촌동 637-22)
➡️전세: 전세 4억 8,000만 원
➡️정  보: 84.60㎡ (~25.6평) / 방 3개, 욕실 2개
➡️특  징: 남향, 101동, 9층/총9층
➡️공개비고: 깨끗,남향,10월말
➡️문  의: 우리대동공인중개사사무소 (02-3665-5466)`;

            const handlePreview = () => {
                if (pasteText.trim()) {
                    const parsed = parsePropertyInfo(pasteText);
                    setPreviewData(parsed);
                } else {
                    alert('매물 정보를 입력해주세요.');
                }
            };

            const handleConfirm = () => {
                if (previewData) {
                    onParse(previewData);
                    onClose();
                }
            };

            const handleUseSample = () => {
                setPasteText(sampleText);
            };

            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-lg max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">매물 정보 붙여넣기</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">✕</button>
                        </div>
                        
                        <div className="p-4 space-y-4">
                            <div>
                                <div className="flex items-center justify-between mb-2">
                                    <label className="block text-sm font-medium text-gray-700">매물 정보 (6줄 형식)</label>
                                    <button onClick={handleUseSample} className="text-xs text-blue-600 hover:underline">샘플 사용</button>
                                </div>
                                <textarea
                                    value={pasteText}
                                    onChange={(e) => setPasteText(e.target.value)}
                                    placeholder="여기에 매물 정보를 붙여넣으세요..."
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 parse-textarea"
                                    rows="8"
                                />
                            </div>
                            
                            {previewData && (
                                <div className="bg-gray-50 rounded-lg p-3">
                                    <h4 className="font-medium text-gray-800 mb-2">파싱 결과 미리보기</h4>
                                    <div className="text-sm space-y-1">
                                        <p><span className="font-medium">매물명:</span> {previewData.name}</p>
                                        <p><span className="font-medium">주소:</span> {previewData.address}</p>
                                        <p><span className="font-medium">임대료:</span> {previewData.rent}</p>
                                        <p><span className="font-medium">평수:</span> {previewData.area_pyeong}평 ({previewData.area_sqm}㎡)</p>
                                        <p><span className="font-medium">구조:</span> 방{previewData.rooms}개, 욕실{previewData.bathrooms}개</p>
                                        <p><span className="font-medium">위치:</span> {previewData.direction}, {previewData.building}, {previewData.floor}/{previewData.totalFloor}</p>
                                        <p><span className="font-medium">비고:</span> {previewData.notes}</p>
                                        <p><span className="font-medium">문의:</span> {previewData.agencyName} ({previewData.contact})</p>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="p-4 border-t border-gray-100 flex space-x-3">
                            <button onClick={onClose} className="flex-1 py-2 border border-gray-300 rounded-md hover:bg-gray-50">취소</button>
                            {!previewData ? (
                                <button onClick={handlePreview} className="flex-1 bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700">미리보기</button>
                            ) : (
                                <button onClick={handleConfirm} className="flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">적용</button>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // MeetingEdit 컴포넌트
        function MeetingEdit({ meetingId, meeting, onSave, onBack }) {
            const [formData, setFormData] = useState({
                customerName: meeting?.customerName || '',
                date: meeting?.date || new Date().toISOString().split('T')[0],
                purpose: meeting?.purpose || '전세',
                status: meeting?.status || '계획중',
                properties: meeting?.properties || [{
                    id: Date.now().toString(),
                    name: '',
                    area_pyeong: '',
                    address: '',
                    visitTime: '',
                    contact: '',
                    contactType: '집주인',
                    status: '확인전',
                    rent: '',
                    notes: [],
                    customerReaction: '',
                    photos: []
                }]
            });
            
            const [showPasteModal, setShowPasteModal] = useState(false);
            const [editingPropertyIndex, setEditingPropertyIndex] = useState(null);
            const [showCamera, setShowCamera] = useState(false);
            const [photoPropertyIndex, setPhotoPropertyIndex] = useState(null);

            const handleInputChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            const handlePropertyChange = (index, field, value) => {
                const updatedProperties = [...formData.properties];
                updatedProperties[index] = { ...updatedProperties[index], [field]: value };
                setFormData(prev => ({ ...prev, properties: updatedProperties }));
            };

            const addProperty = () => {
                const newProperty = {
                    id: Date.now().toString(),
                    name: '',
                    area_pyeong: '',
                    address: '',
                    visitTime: '',
                    contact: '',
                    contactType: '집주인',
                    status: '확인전',
                    rent: '',
                    notes: [],
                    customerReaction: '',
                    photos: []
                };
                setFormData(prev => ({ 
                    ...prev, 
                    properties: [...prev.properties, newProperty] 
                }));
            };

            const removeProperty = (index) => {
                setFormData(prev => ({
                    ...prev,
                    properties: prev.properties.filter((_, i) => i !== index)
                }));
            };

            const handlePasteProperty = (index) => {
                setEditingPropertyIndex(index);
                setShowPasteModal(true);
            };

            const handleParsedData = (parsedData) => {
                if (editingPropertyIndex !== null) {
                    const updatedProperties = [...formData.properties];
                    updatedProperties[editingPropertyIndex] = {
                        ...updatedProperties[editingPropertyIndex],
                        name: parsedData.name,
                        address: parsedData.address,
                        area_sqm: parsedData.area_sqm,
                        area_pyeong: parsedData.area_pyeong,
                        rooms: parsedData.rooms,
                        bathrooms: parsedData.bathrooms,
                        direction: parsedData.direction,
                        building: parsedData.building,
                        floor: parsedData.floor,
                        totalFloor: parsedData.totalFloor,
                        rent: parsedData.rent,
                        contact: parsedData.contact,
                        contactType: parsedData.contactType,
                        agencyName: parsedData.agencyName,
                        notes: parsedData.notes ? parsedData.notes.split(',').map(n => n.trim()) : []
                    };
                    setFormData(prev => ({ ...prev, properties: updatedProperties }));
                }
                setEditingPropertyIndex(null);
            };

            const handleTakePhoto = (index) => {
                setPhotoPropertyIndex(index);
                setShowCamera(true);
            };

            const handlePhotoCapture = async (photoData) => {
                if (photoPropertyIndex !== null) {
                    const resizedPhoto = await PhotoManager.resizeImage(photoData);
                    const updatedProperties = [...formData.properties];
                    if (!updatedProperties[photoPropertyIndex].photos) {
                        updatedProperties[photoPropertyIndex].photos = [];
                    }
                    updatedProperties[photoPropertyIndex].photos.push({
                        id: Date.now().toString(),
                        data: resizedPhoto,
                        timestamp: new Date().toISOString()
                    });
                    setFormData(prev => ({ ...prev, properties: updatedProperties }));
                }
                setShowCamera(false);
                setPhotoPropertyIndex(null);
            };

            const handleDeletePhoto = (propertyIndex, photoId) => {
                const updatedProperties = [...formData.properties];
                updatedProperties[propertyIndex].photos = updatedProperties[propertyIndex].photos.filter(photo => photo.id !== photoId);
                setFormData(prev => ({ ...prev, properties: updatedProperties }));
            };

            const handleSave = () => {
                if (!formData.customerName.trim()) {
                    alert('고객명을 입력해주세요.');
                    return;
                }
                
                const validProperties = formData.properties.filter(p => p.name.trim());
                if (validProperties.length === 0) {
                    alert('최소 하나의 매물 정보를 입력해주세요.');
                    return;
                }

                onSave({
                    ...formData,
                    properties: validProperties
                });
            };

            if (showCamera) {
                return <CameraView onCapture={handlePhotoCapture} onClose={() => setShowCamera(false)} />;
            }

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen">
                    <div className="flex items-center justify-between p-4 border-b border-gray-100">
                        <div className="flex items-center space-x-3">
                            <button onClick={onBack} className="text-blue-600 font-semibold text-lg">←</button>
                            <h1 className="font-semibold text-gray-800">
                                {meetingId === 'new' ? '새 미팅' : '미팅 편집'}
                            </h1>
                        </div>
                        <button onClick={handleSave} className="text-blue-600 font-medium">저장</button>
                    </div>

                    <div className="p-4 space-y-6 pb-20">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">고객명</label>
                            <input
                                type="text"
                                value={formData.customerName}
                                onChange={(e) => handleInputChange('customerName', e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="고객명을 입력하세요"
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">날짜</label>
                                <input
                                    type="date"
                                    value={formData.date}
                                    onChange={(e) => handleInputChange('date', e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">목적</label>
                                <select
                                    value={formData.purpose}
                                    onChange={(e) => handleInputChange('purpose', e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="전세">전세</option>
                                    <option value="월세">월세</option>
                                    <option value="매매">매매</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="text-lg font-medium text-gray-800">매물 정보</h3>
                                <button
                                    onClick={addProperty}
                                    className="px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700"
                                >
                                    + 매물 추가
                                </button>
                            </div>

                            {formData.properties.map((property, index) => (
                                <div key={property.id} className="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-100">
                                    <div className="flex items-center justify-between mb-3">
                                        <h4 className="font-medium text-gray-700">매물 {index + 1}</h4>
                                        <div className="flex space-x-2">
                                            <button
                                                onClick={() => handlePasteProperty(index)}
                                                className="text-blue-600 text-sm hover:underline"
                                            >
                                                📋 붙여넣기
                                            </button>
                                            <button
                                                onClick={() => handleTakePhoto(index)}
                                                className="text-green-600 text-sm hover:underline"
                                            >
                                                📷 촬영
                                            </button>
                                            {formData.properties.length > 1 && (
                                                <button
                                                    onClick={() => removeProperty(index)}
                                                    className="text-red-500 text-sm hover:underline"
                                                >
                                                    삭제
                                                </button>
                                            )}
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        <input
                                            type="text"
                                            placeholder="매물명"
                                            value={property.name}
                                            onChange={(e) => handlePropertyChange(index, 'name', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                        <input
                                            type="number"
                                            placeholder="평수"
                                            value={property.area_pyeong}
                                            onChange={(e) => handlePropertyChange(index, 'area_pyeong', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                    </div>

                                    <input
                                        type="text"
                                        placeholder="주소"
                                        value={property.address}
                                        onChange={(e) => handlePropertyChange(index, 'address', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm mb-3"
                                    />

                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        <input
                                            type="time"
                                            value={property.visitTime}
                                            onChange={(e) => handlePropertyChange(index, 'visitTime', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                        <input
                                            type="text"
                                            placeholder="연락처"
                                            value={property.contact}
                                            onChange={(e) => handlePropertyChange(index, 'contact', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                    </div>

                                    <input
                                        type="text"
                                        placeholder="임대료 (예: 전세 5억, 월세 200/70)"
                                        value={property.rent}
                                        onChange={(e) => handlePropertyChange(index, 'rent', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm mb-3"
                                    />

                                    {/* 파싱된 추가 정보 표시 */}
                                    {(property.rooms || property.direction || property.building) && (
                                        <div className="p-2 bg-blue-50 rounded text-xs text-gray-600 mb-3">
                                            <div className="grid grid-cols-2 gap-2">
                                                {property.rooms && <span>방 {property.rooms}개</span>}
                                                {property.bathrooms && <span>욕실 {property.bathrooms}개</span>}
                                                {property.direction && <span>{property.direction}</span>}
                                                {property.building && <span>{property.building}</span>}
                                                {property.floor && property.totalFloor && <span>{property.floor}/{property.totalFloor}</span>}
                                                {property.agencyName && <span>{property.agencyName}</span>}
                                            </div>
                                        </div>
                                    )}

                                    {/* 사진 미리보기 */}
                                    {property.photos && property.photos.length > 0 && (
                                        <div className="mt-3">
                                            <p className="text-sm font-medium text-gray-700 mb-2">첨부된 사진</p>
                                            <div className="flex space-x-2 overflow-x-auto">
                                                {property.photos.map((photo) => (
                                                    <div key={photo.id} className="relative flex-shrink-0">
                                                        <img 
                                                            src={photo.data} 
                                                            alt="매물 사진" 
                                                            className="photo-preview"
                                                        />
                                                        <button
                                                            onClick={() => handleDeletePhoto(index, photo.id)}
                                                            className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center"
                                                        >
                                                            ✕
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    {showPasteModal && (
                        <PropertyPasteModal 
                            onClose={() => {
                                setShowPasteModal(false);
                                setEditingPropertyIndex(null);
                            }}
                            onParse={handleParsedData}
                        />
                    )}
                </div>
            );
        }

        // MeetingDetail 컴포넌트
        function MeetingDetail({ meetingId, meeting, onBack, onEdit, onUpdate, messageTemplates, onUpdateTemplates }) {
            const [showMessageModal, setShowMessageModal] = useState(false);
            const [showReportModal, setShowReportModal] = useState(false);
            const [editingProperty, setEditingProperty] = useState(null);
            const [propertyNotes, setPropertyNotes] = useState('');
            const [customerReaction, setCustomerReaction] = useState('');
            const [showCamera, setShowCamera] = useState(false);
            const [photoPropertyIndex, setPhotoPropertyIndex] = useState(null);
            const [selectedProperty, setSelectedProperty] = useState(null);

            if (!meeting) {
                return (
                    <div className="max-w-md mx-auto bg-white min-h-screen flex items-center justify-center">
                        <p className="text-gray-400">미팅을 찾을 수 없습니다</p>
                    </div>
                );
            }

            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return `${date.getMonth() + 1}월 ${date.getDate()}일`;
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case '볼수있음': return 'text-green-600';
                    case '확인중': return 'text-orange-500';
                    case '보류': return 'text-red-500';
                    case '확인전': return 'text-gray-500';
                    default: return 'text-gray-400';
                }
            };

            const handleCall = (phone) => {
                if (phone) {
                    window.location.href = `tel:${phone}`;
                }
            };

            const handleStatusChange = (propertyId, newStatus) => {
                const updatedMeeting = {
                    ...meeting,
                    properties: meeting.properties.map(prop =>
                        prop.id === propertyId ? { ...prop, status: newStatus } : prop
                    )
                };
                onUpdate(updatedMeeting);
            };

            const handleEditNotes = (property) => {
                setEditingProperty(property);
                setPropertyNotes(Array.isArray(property.notes) ? property.notes.join(', ') : property.notes || '');
                setCustomerReaction(property.customerReaction || '');
            };

            const handleSaveNotes = () => {
                if (editingProperty) {
                    const updatedMeeting = {
                        ...meeting,
                        properties: meeting.properties.map(prop =>
                            prop.id === editingProperty.id 
                                ? { 
                                    ...prop, 
                                    notes: propertyNotes.split(',').map(note => note.trim()).filter(note => note),
                                    customerReaction: customerReaction
                                } 
                                : prop
                        )
                    };
                    onUpdate(updatedMeeting);
                    setEditingProperty(null);
                    setPropertyNotes('');
                    setCustomerReaction('');
                }
            };

            const handleTakePhoto = (index) => {
                setPhotoPropertyIndex(index);
                setShowCamera(true);
            };

            const handlePhotoCapture = async (photoData) => {
                if (photoPropertyIndex !== null) {
                    const resizedPhoto = await PhotoManager.resizeImage(photoData);
                    const updatedMeeting = {
                        ...meeting,
                        properties: meeting.properties.map((prop, index) =>
                            index === photoPropertyIndex 
                                ? {
                                    ...prop,
                                    photos: [
                                        ...(prop.photos || []),
                                        {
                                            id: Date.now().toString(),
                                            data: resizedPhoto,
                                            timestamp: new Date().toISOString()
                                        }
                                    ]
                                }
                                : prop
                        )
                    };
                    onUpdate(updatedMeeting);
                }
                setShowCamera(false);
                setPhotoPropertyIndex(null);
            };

            const handleDeletePhoto = (propertyIndex, photoId) => {
                const updatedMeeting = {
                    ...meeting,
                    properties: meeting.properties.map((prop, index) =>
                        index === propertyIndex 
                            ? {
                                ...prop,
                                photos: prop.photos.filter(photo => photo.id !== photoId)
                            }
                            : prop
                    )
                };
                onUpdate(updatedMeeting);
            };

            if (showCamera) {
                return <CameraView onCapture={handlePhotoCapture} onClose={() => setShowCamera(false)} />;
            }

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen">
                    <div className="flex items-center justify-between p-4 border-b border-gray-100">
                        <div className="flex items-center space-x-3">
                            <button onClick={onBack} className="text-blue-600 font-semibold text-lg">←</button>
                            <div>
                                <h1 className="font-semibold text-gray-800">{meeting.customerName}님 미팅</h1>
                                <p className="text-sm text-gray-500">{formatDate(meeting.date)} • {meeting.purpose}</p>
                            </div>
                        </div>
                        <div className="flex space-x-2">
                            <button onClick={() => setShowMessageModal(true)} className="text-green-600 text-sm font-medium">문자</button>
                            <button onClick={onEdit} className="text-blue-600 font-medium">편집</button>
                        </div>
                    </div>

                    <div className="p-4 pb-20">
                        <h3 className="text-lg font-medium text-gray-800 mb-4">매물 목록</h3>
                        <div className="space-y-2">
                            {meeting.properties.map((property, index) => (
                                <div 
                                    key={property.id} 
                                    className="bg-gray-50 rounded-lg p-3 border border-gray-100 cursor-pointer hover:bg-gray-100 transition-colors"
                                    onClick={() => setSelectedProperty(property)}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex-1">
                                            <p className="font-medium text-gray-800">
                                                {property.name} {property.area_pyeong}평 {property.address} {property.visitTime}
                                            </p>
                                            <div className="flex items-center space-x-2 mt-1">
                                                <span className={`px-2 py-1 text-xs rounded-full ${getStatusColor(property.status)} bg-opacity-10`}>
                                                    {property.status}
                                                </span>
                                                {property.photos && property.photos.length > 0 && (
                                                    <span className="text-xs text-blue-600">📷 {property.photos.length}장</span>
                                                )}
                                                {Array.isArray(property.notes) && property.notes.length > 0 && (
                                                    <span className="text-xs text-green-600">📝 메모</span>
                                                )}
                                                {property.customerReaction && (
                                                    <span className="text-xs text-purple-600">💬 반응</span>
                                                )}
                                            </div>
                                        </div>
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleCall(property.contact);
                                            }}
                                            className="ml-3 px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"
                                        >
                                            📞
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t border-gray-100 p-4">
                        <button 
                            onClick={() => setShowReportModal(true)}
                            className="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700"
                        >
                            보고서 생성
                        </button>
                    </div>

                    {showMessageModal && (
                        <MessageModal 
                            onClose={() => setShowMessageModal(false)}
                            meeting={meeting}
                            templates={messageTemplates}
                        />
                    )}

                    {showReportModal && (
                        <ReportModal 
                            onClose={() => setShowReportModal(false)}
                            meeting={meeting}
                        />
                    )}

                    {editingProperty && (
                        <NotesModal 
                            property={editingProperty}
                            notes={propertyNotes}
                            reaction={customerReaction}
                            onNotesChange={setPropertyNotes}
                            onReactionChange={setCustomerReaction}
                            onSave={handleSaveNotes}
                            onClose={() => setEditingProperty(null)}
                        />
                    )}

                    {selectedProperty && (
                        <PropertyDetailModal 
                            property={selectedProperty}
                            meeting={meeting}
                            onClose={() => setSelectedProperty(null)}
                            onStatusChange={handleStatusChange}
                            onCall={handleCall}
                            onTakePhoto={handleTakePhoto}
                            onDeletePhoto={handleDeletePhoto}
                            onEditNotes={handleEditNotes}
                            getStatusColor={getStatusColor}
                        />
                    )}
                </div>
            );
        }

        // PropertyDetailModal 컴포넌트
        function PropertyDetailModal({ property, meeting, onClose, onStatusChange, onCall, onTakePhoto, onDeletePhoto, onEditNotes, getStatusColor }) {
            const propertyIndex = meeting.properties.findIndex(p => p.id === property.id);
            
            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-md max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">매물 상세정보</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">✕</button>
                        </div>
                        
                        <div className="p-4 space-y-4">
                            {/* 기본 정보 */}
                            <div>
                                <h4 className="font-medium text-gray-800 text-lg mb-2">
                                    {property.name} {property.area_pyeong}평
                                </h4>
                                <p className="text-gray-600 mb-1">{property.address}</p>
                                <p className="text-gray-600 mb-1">방문시간: {property.visitTime}</p>
                                <p className="text-gray-600 mb-3">{property.rent}</p>
                            </div>

                            {/* 상세 정보 */}
                            {(property.rooms || property.direction || property.building) && (
                                <div className="bg-blue-50 rounded-lg p-3">
                                    <h5 className="font-medium text-gray-700 mb-2">상세정보</h5>
                                    <div className="grid grid-cols-2 gap-2 text-sm">
                                        {property.rooms && <span>방 {property.rooms}개</span>}
                                        {property.bathrooms && <span>욕실 {property.bathrooms}개</span>}
                                        {property.direction && <span>{property.direction}</span>}
                                        {property.building && <span>{property.building}</span>}
                                        {property.floor && property.totalFloor && <span>{property.floor}/{property.totalFloor}</span>}
                                        {property.agencyName && <span className="col-span-2">{property.agencyName}</span>}
                                    </div>
                                </div>
                            )}

                            {/* 상태 및 액션 버튼 */}
                            <div className="flex items-center justify-between">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">상태</label>
                                    <select
                                        value={property.status}
                                        onChange={(e) => onStatusChange(property.id, e.target.value)}
                                        className={`text-sm font-medium border border-gray-300 rounded px-2 py-1 ${getStatusColor(property.status)} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                    >
                                        <option value="확인전">확인전</option>
                                        <option value="확인중">확인중</option>
                                        <option value="볼수있음">볼수있음</option>
                                        <option value="보류">보류</option>
                                    </select>
                                </div>
                                <div className="flex space-x-2">
                                    <button
                                        onClick={() => onCall(property.contact)}
                                        className="px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700"
                                    >
                                        📞 전화
                                    </button>
                                    <button
                                        onClick={() => {
                                            onTakePhoto(propertyIndex);
                                            onClose();
                                        }}
                                        className="px-3 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700"
                                    >
                                        📷 촬영
                                    </button>
                                </div>
                            </div>

                            {/* 연락처 정보 */}
                            <div className="bg-gray-50 rounded-lg p-3">
                                <p className="text-sm text-gray-600">
                                    <span className="font-medium">{property.agencyName || property.contactType}:</span> {property.contact}
                                </p>
                            </div>

                            {/* 사진 */}
                            {property.photos && property.photos.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-gray-700 mb-2">첨부된 사진 ({property.photos.length}장)</h5>
                                    <div className="grid grid-cols-3 gap-2">
                                        {property.photos.map((photo) => (
                                            <div key={photo.id} className="relative">
                                                <img 
                                                    src={photo.data} 
                                                    alt="매물 사진" 
                                                    className="w-full h-20 object-cover rounded cursor-pointer"
                                                    onClick={() => window.open(photo.data)}
                                                />
                                                <button
                                                    onClick={() => onDeletePhoto(propertyIndex, photo.id)}
                                                    className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center"
                                                >
                                                    ✕
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* 현장 기록 */}
                            <div>
                                <div className="flex items-center justify-between mb-2">
                                    <h5 className="font-medium text-gray-700">현장 기록</h5>
                                    <button
                                        onClick={() => {
                                            onEditNotes(property);
                                            onClose();
                                        }}
                                        className="text-blue-600 text-sm hover:underline"
                                    >
                                        편집
                                    </button>
                                </div>
                                
                                {Array.isArray(property.notes) && property.notes.length > 0 && (
                                    <div className="mb-3">
                                        <p className="text-sm font-medium text-gray-600 mb-1">메모</p>
                                        <div className="space-y-1">
                                            {property.notes.map((note, noteIndex) => (
                                                <p key={noteIndex} className="text-sm text-gray-800">• {note}</p>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {property.customerReaction && (
                                    <div>
                                        <p className="text-sm font-medium text-gray-600 mb-1">고객 반응</p>
                                        <p className="text-sm text-gray-800">{property.customerReaction}</p>
                                    </div>
                                )}
                                
                                {(!Array.isArray(property.notes) || property.notes.length === 0) && !property.customerReaction && (
                                    <p className="text-sm text-gray-400">현장 기록이 없습니다</p>
                                )}
                            </div>
                        </div>
                        
                        <div className="p-4 border-t border-gray-100">
                            <button 
                                onClick={onClose}
                                className="w-full bg-gray-100 text-gray-700 py-2 rounded-md hover:bg-gray-200"
                            >
                                닫기
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // MessageModal 컴포넌트
        function MessageModal({ onClose, meeting, templates }) {
            const handleSendMessage = (template) => {
                const message = template.message.replace('OOO부동산', '미팅노트부동산');
                alert(`문자 전송:\n수신: ${meeting.properties[0]?.contact}\n내용: ${message}`);
                onClose();
            };

            return (
                <div className="fixed inset-0 modal-backdrop flex items-end justify-center z-50">
                    <div className="bg-white rounded-t-lg w-full max-w-md max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">문자 템플릿</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">✕</button>
                        </div>
                        <div className="p-4 space-y-3">
                            {templates.map(template => (
                                <div key={template.id} className="border border-gray-200 rounded-lg p-3">
                                    <h4 className="font-medium text-gray-800 mb-1">{template.name}</h4>
                                    <p className="text-sm text-gray-600 mb-3">{template.message}</p>
                                    <button 
                                        onClick={() => handleSendMessage(template)}
                                        className="w-full bg-green-600 text-white py-2 rounded-md text-sm hover:bg-green-700"
                                    >
                                        전송
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // ReportModal 컴포넌트
        function ReportModal({ onClose, meeting }) {
            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return `${date.getFullYear()}년 ${date.getMonth() + 1}월 ${date.getDate()}일`;
            };

            const handleShare = () => {
                if (navigator.share) {
                    navigator.share({
                        title: `${meeting.customerName}님 미팅 보고서`,
                        text: `${formatDate(meeting.date)} 미팅 결과를 공유합니다.`
                    });
                } else {
                    alert('보고서가 갤러리에 저장되었습니다.');
                }
                onClose();
            };

            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-sm max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">보고서 미리보기</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">✕</button>
                        </div>
                        
                        <div className="p-4 bg-gray-50 text-sm">
                            <div className="bg-white p-3 rounded border text-center">
                                <h2 className="font-bold text-lg mb-3">미팅 보고서</h2>
                                <p className="text-gray-600 mb-4">
                                    {meeting.customerName}님 • {formatDate(meeting.date)}
                                </p>
                                
                                {meeting.properties.map((property, index) => (
                                    <div key={property.id} className="text-left mb-3 pb-3 border-b border-gray-100 last:border-b-0">
                                        <h4 className="font-semibold">{property.name} {property.area_pyeong}평</h4>
                                        <p className="text-gray-600 text-xs">{property.address}</p>
                                        <p className="text-gray-600 text-xs">{property.rent}</p>
                                        
                                        {(property.rooms || property.direction) && (
                                            <p className="text-gray-600 text-xs">
                                                {property.rooms && `방${property.rooms}개 `}
                                                {property.bathrooms && `욕실${property.bathrooms}개 `}
                                                {property.direction && `${property.direction} `}
                                                {property.building && `${property.building} `}
                                                {property.floor && property.totalFloor && `${property.floor}/${property.totalFloor}`}
                                            </p>
                                        )}
                                        
                                        {Array.isArray(property.notes) && property.notes.length > 0 && (
                                            <div className="mt-2">
                                                <p className="text-xs font-medium">메모:</p>
                                                {property.notes.map((note, i) => (
                                                    <p key={i} className="text-xs text-gray-700">• {note}</p>
                                                ))}
                                            </div>
                                        )}
                                        
                                        {property.customerReaction && (
                                            <p className="text-xs mt-1">
                                                <span className="font-medium">고객 반응:</span> {property.customerReaction}
                                            </p>
                                        )}

                                        {property.photos && property.photos.length > 0 && (
                                            <p className="text-xs mt-1 text-blue-600">
                                                📷 첨부된 사진: {property.photos.length}장
                                            </p>
                                        )}
                                    </div>
                                ))}
                                
                                <p className="text-xs text-gray-500 mt-4">
                                    미팅노트 앱으로 작성됨
                                </p>
                            </div>
                        </div>
                        
                        <div className="p-4 border-t border-gray-100">
                            <button 
                                onClick={handleShare}
                                className="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700"
                            >
                                공유하기
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // NotesModal 컴포넌트
        function NotesModal({ property, notes, reaction, onNotesChange, onReactionChange, onSave, onClose }) {
            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-sm">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">현장 기록 편집</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">✕</button>
                        </div>
                        
                        <div className="p-4 space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    메모 (쉼표로 구분)
                                </label>
                                <textarea
                                    value={notes}
                                    onChange={(e) => onNotesChange(e.target.value)}
                                    placeholder="채광 좋음, 리모델링 깔끔함"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="3"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    고객 반응
                                </label>
                                <input
                                    type="text"
                                    value={reaction}
                                    onChange={(e) => onReactionChange(e.target.value)}
                                    placeholder="매우 만족, 관심 있음"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                        </div>
                        
                        <div className="p-4 border-t border-gray-100 flex space-x-3">
                            <button 
                                onClick={onClose}
                                className="flex-1 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
                            >
                                취소
                            </button>
                            <button 
                                onClick={onSave}
                                className="flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700"
                            >
                                저장
                            </button>
                        </div>
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>