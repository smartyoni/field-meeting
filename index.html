<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎØ∏ÌåÖ ÎÖ∏Ìä∏ - ÏôÑÏ†ÑÌïú Í∏∞Îä•</title>
    <link rel="manifest" href="/public/manifest.json">
    <meta name="theme-color" content="#0F62FE">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #ffffff;
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .parse-textarea {
            font-family: 'Courier New', monospace;
            line-height: 1.6;
        }
        .install-prompt {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #0F62FE;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        .camera-view {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: black;
            z-index: 2000;
            display: flex;
            flex-direction: column;
        }
        .photo-preview {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Í¥ÄÎ¶¨ Ìï®ÏàòÎì§
        const StorageManager = {
            MEETINGS_KEY: 'field-meeting-data',
            TEMPLATES_KEY: 'field-meeting-templates',
            
            saveMeetings: (meetings) => {
                try {
                    localStorage.setItem(StorageManager.MEETINGS_KEY, JSON.stringify(meetings));
                } catch (error) {
                    console.error('Failed to save meetings:', error);
                }
            },
            
            loadMeetings: () => {
                try {
                    const data = localStorage.getItem(StorageManager.MEETINGS_KEY);
                    return data ? JSON.parse(data) : initialMeetings;
                } catch (error) {
                    console.error('Failed to load meetings:', error);
                    return initialMeetings;
                }
            },
            
            saveTemplates: (templates) => {
                try {
                    localStorage.setItem(StorageManager.TEMPLATES_KEY, JSON.stringify(templates));
                } catch (error) {
                    console.error('Failed to save templates:', error);
                }
            },
            
            loadTemplates: () => {
                try {
                    const data = localStorage.getItem(StorageManager.TEMPLATES_KEY);
                    return data ? JSON.parse(data) : defaultTemplates;
                } catch (error) {
                    console.error('Failed to load templates:', error);
                    return defaultTemplates;
                }
            }
        };

        // PWA ÏÑ§Ïπò Í¥ÄÎ¶¨
        const PWAManager = {
            deferredPrompt: null,
            
            init: () => {
                // ÏÑúÎπÑÏä§ ÏõåÏª§ Îì±Î°ù
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('/sw.js')
                        .then((registration) => {
                            console.log('Service Worker Îì±Î°ù ÏÑ±Í≥µ:', registration);
                        })
                        .catch((error) => {
                            console.log('Service Worker Îì±Î°ù Ïã§Ìå®:', error);
                        });
                }

                // PWA ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ Ï≤òÎ¶¨
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    PWAManager.deferredPrompt = e;
                });
            },
            
            install: async () => {
                if (PWAManager.deferredPrompt) {
                    PWAManager.deferredPrompt.prompt();
                    const { outcome } = await PWAManager.deferredPrompt.userChoice;
                    PWAManager.deferredPrompt = null;
                    return outcome === 'accepted';
                }
                return false;
            }
        };

        // ÏÇ¨ÏßÑ Í¥ÄÎ¶¨
        const PhotoManager = {
            takePhoto: async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        video: { facingMode: 'environment' } 
                    });
                    return stream;
                } catch (error) {
                    console.error('Camera access failed:', error);
                    return null;
                }
            },
            
            captureFrame: (video) => {
                const canvas = document.createElement('canvas');
                canvas.width = 1920;
                canvas.height = 1080;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                return canvas.toDataURL('image/jpeg', 0.9);
            },
            
            resizeImage: (dataUrl, maxWidth = 800) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        const ratio = Math.min(maxWidth / img.width, maxWidth / img.height);
                        canvas.width = img.width * ratio;
                        canvas.height = img.height * ratio;
                        
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.8));
                    };
                    img.src = dataUrl;
                });
            }
        };
        
        // Îß§Î¨º Ï†ïÎ≥¥ ÌååÏã± Ìï®Ïàò
        function parsePropertyInfo(text) {
            const lines = text.split('\n').map(line => line.trim()).filter(line => line);
            
            let result = {
                name: '',
                address: '',
                rent: '',
                area_sqm: '',
                area_pyeong: '',
                rooms: '',
                bathrooms: '',
                direction: '',
                building: '',
                floor: '',
                totalFloor: '',
                notes: '',
                contact: '',
                contactType: 'Î∂ÄÎèôÏÇ∞',
                agencyName: ''
            };
            
            lines.forEach((line, index) => {
                if (index === 0) {
                    const match = line.match(/^‚û°Ô∏è?(.+?)\s*\((.+?)\)/);
                    if (match) {
                        result.name = match[1].trim();
                        result.address = match[2].trim();
                    } else {
                        result.name = line.replace(/^‚û°Ô∏è/, '').trim();
                    }
                }
                else if (index === 1 && line.includes('Ï†ÑÏÑ∏')) {
                    const rentMatch = line.match(/Ï†ÑÏÑ∏:\s*(.+)/);
                    if (rentMatch) {
                        result.rent = rentMatch[1].trim();
                    }
                }
                else if (index === 2 && line.includes('Ï†ï  Î≥¥')) {
                    const infoMatch = line.match(/Ï†ï\s*Î≥¥:\s*(.+)/);
                    if (infoMatch) {
                        const info = infoMatch[1];
                        const areaMatch = info.match(/(\d+\.?\d*)„é°\s*\(~?(\d+\.?\d*)Ìèâ\)/);
                        if (areaMatch) {
                            result.area_sqm = areaMatch[1];
                            result.area_pyeong = areaMatch[2];
                        }
                        const roomMatch = info.match(/Î∞©\s*(\d+)Í∞ú/);
                        const bathMatch = info.match(/ÏöïÏã§\s*(\d+)Í∞ú/);
                        if (roomMatch) result.rooms = roomMatch[1];
                        if (bathMatch) result.bathrooms = bathMatch[1];
                    }
                }
                else if (index === 3 && line.includes('Ìäπ  Ïßï')) {
                    const featureMatch = line.match(/Ìäπ\s*Ïßï:\s*(.+)/);
                    if (featureMatch) {
                        const features = featureMatch[1];
                        const directionMatch = features.match(/(ÎÇ®Ìñ•|Î∂ÅÌñ•|ÎèôÌñ•|ÏÑúÌñ•|ÎÇ®ÎèôÌñ•|ÎÇ®ÏÑúÌñ•|Î∂ÅÎèôÌñ•|Î∂ÅÏÑúÌñ•)/);
                        if (directionMatch) result.direction = directionMatch[1];
                        const buildingMatch = features.match(/(\d+)Îèô/);
                        if (buildingMatch) result.building = buildingMatch[1] + 'Îèô';
                        const floorMatch = features.match(/(\d+)Ï∏µ\/Ï¥ù(\d+)Ï∏µ/);
                        if (floorMatch) {
                            result.floor = floorMatch[1] + 'Ï∏µ';
                            result.totalFloor = floorMatch[2] + 'Ï∏µ';
                        }
                    }
                }
                else if (index === 4 && line.includes('Í≥µÍ∞úÎπÑÍ≥†')) {
                    const notesMatch = line.match(/Í≥µÍ∞úÎπÑÍ≥†:\s*(.+)/);
                    if (notesMatch) {
                        result.notes = notesMatch[1].trim();
                    }
                }
                else if (index === 5 && line.includes('Î¨∏  Ïùò')) {
                    const contactMatch = line.match(/Î¨∏\s*Ïùò:\s*(.+?)\s*\((.+?)\)/);
                    if (contactMatch) {
                        result.agencyName = contactMatch[1].trim();
                        result.contact = contactMatch[2].trim();
                        result.contactType = 'Î∂ÄÎèôÏÇ∞';
                    }
                }
            });
            
            return result;
        }
        
        // Ï¥àÍ∏∞ Î™©ÏóÖ Îç∞Ïù¥ÌÑ∞
        const initialMeetings = [
            {
                id: '1',
                customerName: 'ÍπÄÏ≤†Ïàò',
                date: '2024-09-06',
                purpose: 'Ï†ÑÏÑ∏',
                status: 'ÏßÑÌñâÏ§ë',
                properties: [
                    {
                        id: 'prop_1',
                        name: 'ÎåÄÎ¶ºÏïÑÎ•¥Îπå',
                        address: 'Îì±Ï¥åÎèô 637-22',
                        area_sqm: 84.60,
                        area_pyeong: 25.6,
                        rooms: '3',
                        bathrooms: '2',
                        direction: 'ÎÇ®Ìñ•',
                        building: '101Îèô',
                        floor: '9Ï∏µ',
                        totalFloor: '9Ï∏µ',
                        visitTime: '14:00',
                        contact: '02-3665-5466',
                        contactType: 'Î∂ÄÎèôÏÇ∞',
                        agencyName: 'Ïö∞Î¶¨ÎåÄÎèôÍ≥µÏù∏Ï§ëÍ∞úÏÇ¨ÏÇ¨Î¨¥ÏÜå',
                        status: 'Î≥ºÏàòÏûàÏùå',
                        rent: 'Ï†ÑÏÑ∏ 4Ïñµ 8,000Îßå Ïõê',
                        notes: ['Íπ®ÎÅó', 'ÎÇ®Ìñ•', '10ÏõîÎßê'],
                        customerReaction: '',
                        photos: []
                    }
                ]
            }
        ];

        // Í∏∞Î≥∏ Î¨∏Ïûê ÌÖúÌîåÎ¶ø
        const defaultTemplates = [
            { id: 1, name: 'Î∞©Î¨∏ ÏòàÏ†ï ÏïåÎ¶º', message: 'ÏïàÎÖïÌïòÏÑ∏Ïöî. OOOÎ∂ÄÎèôÏÇ∞ÏûÖÎãàÎã§. Ïû†Ïãú ÌõÑ Î∞©Î¨∏ ÏòàÏ†ïÏù¥Îãà ÌôïÏù∏ Î∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§.' },
            { id: 2, name: 'ÎèÑÏ∞© ÏïåÎ¶º', message: 'ÏïàÎÖïÌïòÏÑ∏Ïöî. Îß§Î¨º ÏïûÏóê ÎèÑÏ∞©ÌñàÏäµÎãàÎã§.' },
            { id: 3, name: 'ÏùºÏ†ï Î≥ÄÍ≤Ω', message: 'Ï£ÑÏÜ°Ìï©ÎãàÎã§. Í∏âÌïú ÏùºÏù¥ ÏÉùÍ≤® Î∞©Î¨∏ ÏãúÍ∞ÑÏù¥ Ï°∞Í∏à Îä¶Ïñ¥Ïßà ÏòàÏ†ïÏûÖÎãàÎã§.' },
            { id: 4, name: 'ÎØ∏ÌåÖ ÏôÑÎ£å', message: 'Ïò§Îäò ÎØ∏ÌåÖ Í∞êÏÇ¨ÌñàÏäµÎãàÎã§. Í≥ß Î≥¥Í≥†ÏÑúÎ•º Î≥¥ÎÇ¥ÎìúÎ¶¨Í≤†ÏäµÎãàÎã§.' }
        ];
        
        // Î©îÏù∏ Ïï± Ïª¥Ìè¨ÎÑåÌä∏
        function App() {
            const [currentView, setCurrentView] = useState('list');
            const [selectedMeetingId, setSelectedMeetingId] = useState(null);
            const [meetings, setMeetings] = useState([]);
            const [messageTemplates, setMessageTemplates] = useState([]);
            const [isEditing, setIsEditing] = useState(false);
            const [showInstallPrompt, setShowInstallPrompt] = useState(false);
            
            // Îç∞Ïù¥ÌÑ∞ Î°úÎìú
            useEffect(() => {
                const loadedMeetings = StorageManager.loadMeetings();
                const loadedTemplates = StorageManager.loadTemplates();
                setMeetings(loadedMeetings);
                setMessageTemplates(loadedTemplates);
                
                // PWA Ï¥àÍ∏∞Ìôî
                PWAManager.init();
                
                // ÏÑ§Ïπò ÌîÑÎ°¨ÌîÑÌä∏ Ï≤¥ÌÅ¨
                window.addEventListener('beforeinstallprompt', () => {
                    setShowInstallPrompt(true);
                });
            }, []);
            
            // ÎØ∏ÌåÖ Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Ïãú Ï†ÄÏû•
            useEffect(() => {
                if (meetings.length > 0) {
                    StorageManager.saveMeetings(meetings);
                }
            }, [meetings]);
            
            // ÌÖúÌîåÎ¶ø Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Ïãú Ï†ÄÏû•
            useEffect(() => {
                if (messageTemplates.length > 0) {
                    StorageManager.saveTemplates(messageTemplates);
                }
            }, [messageTemplates]);
            
            const handleMeetingClick = (meetingId) => {
                setSelectedMeetingId(meetingId);
                setCurrentView('detail');
                setIsEditing(false);
            };
            
            const handleNewMeeting = () => {
                setSelectedMeetingId('new');
                setCurrentView('edit');
                setIsEditing(true);
            };
            
            const handleEdit = () => {
                setCurrentView('edit');
                setIsEditing(true);
            };
            
            const handleBackToList = () => {
                setCurrentView('list');
                setSelectedMeetingId(null);
                setIsEditing(false);
            };
            
            const handleBackToDetail = () => {
                setCurrentView('detail');
                setIsEditing(false);
            };
            
            const handleSaveMeeting = (meetingData) => {
                if (selectedMeetingId === 'new') {
                    const newId = Date.now().toString();
                    const newMeeting = { ...meetingData, id: newId };
                    setMeetings([...meetings, newMeeting]);
                    setSelectedMeetingId(newId);
                } else {
                    setMeetings(meetings.map(m => 
                        m.id === selectedMeetingId ? { ...meetingData, id: selectedMeetingId } : m
                    ));
                }
                setCurrentView('detail');
                setIsEditing(false);
            };
            
            const handleUpdateMeeting = (updatedMeeting) => {
                setMeetings(meetings.map(m => 
                    m.id === updatedMeeting.id ? updatedMeeting : m
                ));
            };

            const handleInstallApp = async () => {
                const installed = await PWAManager.install();
                if (installed) {
                    setShowInstallPrompt(false);
                }
            };
            
            if (currentView === 'edit') {
                return <MeetingEdit 
                    meetingId={selectedMeetingId}
                    meeting={selectedMeetingId === 'new' ? null : meetings.find(m => m.id === selectedMeetingId)}
                    onSave={handleSaveMeeting}
                    onBack={selectedMeetingId === 'new' ? handleBackToList : handleBackToDetail}
                />;
            }
            
            if (currentView === 'detail') {
                return <MeetingDetail 
                    meetingId={selectedMeetingId} 
                    meeting={meetings.find(m => m.id === selectedMeetingId)}
                    onBack={handleBackToList}
                    onEdit={handleEdit}
                    onUpdate={handleUpdateMeeting}
                    messageTemplates={messageTemplates}
                    onUpdateTemplates={setMessageTemplates}
                />;
            }
            
            return (
                <>
                    <MeetingList 
                        meetings={meetings}
                        onMeetingClick={handleMeetingClick} 
                        onNewMeeting={handleNewMeeting}
                    />
                    {showInstallPrompt && (
                        <div className="install-prompt">
                            <div className="flex items-center justify-between">
                                <span className="mr-4">Ïï±ÏùÑ Ìôà ÌôîÎ©¥Ïóê ÏÑ§ÏπòÌïòÏãúÍ≤†ÏäµÎãàÍπå?</span>
                                <div>
                                    <button 
                                        onClick={handleInstallApp}
                                        className="bg-white text-blue-600 px-3 py-1 rounded mr-2 text-sm font-medium"
                                    >
                                        ÏÑ§Ïπò
                                    </button>
                                    <button 
                                        onClick={() => setShowInstallPrompt(false)}
                                        className="text-blue-100 text-sm"
                                    >
                                        ÎÇòÏ§ëÏóê
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }
        
        // ÎØ∏ÌåÖ Î¶¨Ïä§Ìä∏ Ïª¥Ìè¨ÎÑåÌä∏ (Í∏∞Ï°¥Í≥º ÎèôÏùº)
        function MeetingList({ meetings, onMeetingClick, onNewMeeting }) {
            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return `${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
            };

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen">
                    <div className="flex items-center justify-between p-4 border-b border-gray-100">
                        <h1 className="text-xl font-semibold text-gray-800">ÎØ∏ÌåÖ ÎÖ∏Ìä∏</h1>
                        <button 
                            onClick={onNewMeeting}
                            className="w-8 h-8 bg-blue-600 text-white rounded-full flex items-center justify-center text-lg font-semibold hover:bg-blue-700"
                        >
                            +
                        </button>
                    </div>

                    <div className="p-4 space-y-3">
                        {meetings.length === 0 ? (
                            <div className="text-center py-12 text-gray-400">
                                <p>Îì±Î°ùÎêú ÎØ∏ÌåÖÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                <p className="text-sm mt-1">+ Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÏÉà ÎØ∏ÌåÖÏùÑ Ï∂îÍ∞ÄÌïòÏÑ∏Ïöî</p>
                            </div>
                        ) : (
                            meetings.map((meeting) => (
                                <div 
                                    key={meeting.id} 
                                    className="bg-gray-50 rounded-lg p-4 border border-gray-100 hover:shadow-sm transition-shadow cursor-pointer"
                                    onClick={() => onMeetingClick(meeting.id)}
                                >
                                    <div className="flex items-start justify-between mb-2">
                                        <div className="flex items-center space-x-2">
                                            <span className="text-sm text-gray-500">
                                                {formatDate(meeting.date)}
                                            </span>
                                            <span className="text-gray-400">‚Ä¢</span>
                                            <span className="font-medium text-gray-800">
                                                {meeting.customerName}Îãò
                                            </span>
                                        </div>
                                        <span className={`px-2 py-1 text-xs rounded-full ${
                                            meeting.status === 'ÏßÑÌñâÏ§ë' 
                                                ? 'bg-orange-500 text-white' 
                                                : 'bg-gray-200 text-gray-600'
                                        }`}>
                                            {meeting.status}
                                        </span>
                                    </div>
                                    
                                    <div className="flex items-center space-x-2 text-sm text-gray-500">
                                        <span>{meeting.purpose}</span>
                                        <span>‚Ä¢</span>
                                        <span>{meeting.properties.length}Í∞ú Îß§Î¨º</span>
                                    </div>
                                    
                                    <div className="mt-2 text-sm text-gray-500">
                                        {meeting.properties.slice(0, 2).map((prop, index) => (
                                            <span key={index}>
                                                {prop.name} {prop.area_pyeong}Ìèâ
                                                {index < Math.min(meeting.properties.length - 1, 1) && ', '}
                                            </span>
                                        ))}
                                        {meeting.properties.length > 2 && (
                                            <span> Ïô∏ {meeting.properties.length - 2}Í≥≥</span>
                                        )}
                                    </div>
                                </div>
                            ))
                        )}
                    </div>
                </div>
            );
        }

        // Ïπ¥Î©îÎùº Ïª¥Ìè¨ÎÑåÌä∏
        function CameraView({ onCapture, onClose }) {
            const videoRef = useRef(null);
            const [stream, setStream] = useState(null);

            useEffect(() => {
                const startCamera = async () => {
                    const mediaStream = await PhotoManager.takePhoto();
                    if (mediaStream) {
                        setStream(mediaStream);
                        if (videoRef.current) {
                            videoRef.current.srcObject = mediaStream;
                        }
                    }
                };
                startCamera();

                return () => {
                    if (stream) {
                        stream.getTracks().forEach(track => track.stop());
                    }
                };
            }, []);

            const handleCapture = () => {
                if (videoRef.current) {
                    const photoData = PhotoManager.captureFrame(videoRef.current);
                    onCapture(photoData);
                }
            };

            return (
                <div className="camera-view">
                    <div className="flex items-center justify-between p-4 text-white">
                        <button onClick={onClose} className="text-xl">‚úï</button>
                        <h2 className="text-lg font-semibold">Îß§Î¨º Ï¥¨ÏòÅ</h2>
                        <div></div>
                    </div>
                    
                    <div className="flex-1 relative">
                        <video 
                            ref={videoRef}
                            autoPlay 
                            playsInline 
                            className="w-full h-full object-cover"
                        />
                    </div>
                    
                    <div className="p-6 flex justify-center">
                        <button
                            onClick={handleCapture}
                            className="w-16 h-16 bg-white rounded-full border-4 border-gray-300 flex items-center justify-center"
                        >
                            <div className="w-12 h-12 bg-white rounded-full shadow-lg"></div>
                        </button>
                    </div>
                </div>
            );
        }

        // PropertyPasteModal Ïª¥Ìè¨ÎÑåÌä∏
        function PropertyPasteModal({ onClose, onParse }) {
            const [pasteText, setPasteText] = useState('');
            const [previewData, setPreviewData] = useState(null);
            
            const sampleText = `‚û°Ô∏èÎåÄÎ¶ºÏïÑÎ•¥Îπå (Îì±Ï¥åÎèô 637-22)
‚û°Ô∏èÏ†ÑÏÑ∏: Ï†ÑÏÑ∏ 4Ïñµ 8,000Îßå Ïõê
‚û°Ô∏èÏ†ï  Î≥¥: 84.60„é° (~25.6Ìèâ) / Î∞© 3Í∞ú, ÏöïÏã§ 2Í∞ú
‚û°Ô∏èÌäπ  Ïßï: ÎÇ®Ìñ•, 101Îèô, 9Ï∏µ/Ï¥ù9Ï∏µ
‚û°Ô∏èÍ≥µÍ∞úÎπÑÍ≥†: Íπ®ÎÅó,ÎÇ®Ìñ•,10ÏõîÎßê
‚û°Ô∏èÎ¨∏  Ïùò: Ïö∞Î¶¨ÎåÄÎèôÍ≥µÏù∏Ï§ëÍ∞úÏÇ¨ÏÇ¨Î¨¥ÏÜå (02-3665-5466)`;

            const handlePreview = () => {
                if (pasteText.trim()) {
                    const parsed = parsePropertyInfo(pasteText);
                    setPreviewData(parsed);
                } else {
                    alert('Îß§Î¨º Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                }
            };

            const handleConfirm = () => {
                if (previewData) {
                    onParse(previewData);
                    onClose();
                }
            };

            const handleUseSample = () => {
                setPasteText(sampleText);
            };

            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-lg max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">Îß§Î¨º Ï†ïÎ≥¥ Î∂ôÏó¨ÎÑ£Í∏∞</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        
                        <div className="p-4 space-y-4">
                            <div>
                                <div className="flex items-center justify-between mb-2">
                                    <label className="block text-sm font-medium text-gray-700">Îß§Î¨º Ï†ïÎ≥¥ (6Ï§Ñ ÌòïÏãù)</label>
                                    <button onClick={handleUseSample} className="text-xs text-blue-600 hover:underline">ÏÉòÌîå ÏÇ¨Ïö©</button>
                                </div>
                                <textarea
                                    value={pasteText}
                                    onChange={(e) => setPasteText(e.target.value)}
                                    placeholder="Ïó¨Í∏∞Ïóê Îß§Î¨º Ï†ïÎ≥¥Î•º Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî..."
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 parse-textarea"
                                    rows="8"
                                />
                            </div>
                            
                            {previewData && (
                                <div className="bg-gray-50 rounded-lg p-3">
                                    <h4 className="font-medium text-gray-800 mb-2">ÌååÏã± Í≤∞Í≥º ÎØ∏Î¶¨Î≥¥Í∏∞</h4>
                                    <div className="text-sm space-y-1">
                                        <p><span className="font-medium">Îß§Î¨ºÎ™Ö:</span> {previewData.name}</p>
                                        <p><span className="font-medium">Ï£ºÏÜå:</span> {previewData.address}</p>
                                        <p><span className="font-medium">ÏûÑÎåÄÎ£å:</span> {previewData.rent}</p>
                                        <p><span className="font-medium">ÌèâÏàò:</span> {previewData.area_pyeong}Ìèâ ({previewData.area_sqm}„é°)</p>
                                        <p><span className="font-medium">Íµ¨Ï°∞:</span> Î∞©{previewData.rooms}Í∞ú, ÏöïÏã§{previewData.bathrooms}Í∞ú</p>
                                        <p><span className="font-medium">ÏúÑÏπò:</span> {previewData.direction}, {previewData.building}, {previewData.floor}/{previewData.totalFloor}</p>
                                        <p><span className="font-medium">ÎπÑÍ≥†:</span> {previewData.notes}</p>
                                        <p><span className="font-medium">Î¨∏Ïùò:</span> {previewData.agencyName} ({previewData.contact})</p>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="p-4 border-t border-gray-100 flex space-x-3">
                            <button onClick={onClose} className="flex-1 py-2 border border-gray-300 rounded-md hover:bg-gray-50">Ï∑®ÏÜå</button>
                            {!previewData ? (
                                <button onClick={handlePreview} className="flex-1 bg-gray-600 text-white py-2 rounded-md hover:bg-gray-700">ÎØ∏Î¶¨Î≥¥Í∏∞</button>
                            ) : (
                                <button onClick={handleConfirm} className="flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">Ï†ÅÏö©</button>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // MeetingEdit Ïª¥Ìè¨ÎÑåÌä∏
        function MeetingEdit({ meetingId, meeting, onSave, onBack }) {
            const [formData, setFormData] = useState({
                customerName: meeting?.customerName || '',
                date: meeting?.date || new Date().toISOString().split('T')[0],
                purpose: meeting?.purpose || 'Ï†ÑÏÑ∏',
                status: meeting?.status || 'Í≥ÑÌöçÏ§ë',
                properties: meeting?.properties || [{
                    id: Date.now().toString(),
                    name: '',
                    area_pyeong: '',
                    address: '',
                    visitTime: '',
                    contact: '',
                    contactType: 'ÏßëÏ£ºÏù∏',
                    status: 'ÌôïÏù∏Ï†Ñ',
                    rent: '',
                    notes: [],
                    customerReaction: '',
                    photos: []
                }]
            });
            
            const [showPasteModal, setShowPasteModal] = useState(false);
            const [editingPropertyIndex, setEditingPropertyIndex] = useState(null);
            const [showCamera, setShowCamera] = useState(false);
            const [photoPropertyIndex, setPhotoPropertyIndex] = useState(null);

            const handleInputChange = (field, value) => {
                setFormData(prev => ({ ...prev, [field]: value }));
            };

            const handlePropertyChange = (index, field, value) => {
                const updatedProperties = [...formData.properties];
                updatedProperties[index] = { ...updatedProperties[index], [field]: value };
                setFormData(prev => ({ ...prev, properties: updatedProperties }));
            };

            const addProperty = () => {
                const newProperty = {
                    id: Date.now().toString(),
                    name: '',
                    area_pyeong: '',
                    address: '',
                    visitTime: '',
                    contact: '',
                    contactType: 'ÏßëÏ£ºÏù∏',
                    status: 'ÌôïÏù∏Ï†Ñ',
                    rent: '',
                    notes: [],
                    customerReaction: '',
                    photos: []
                };
                setFormData(prev => ({ 
                    ...prev, 
                    properties: [...prev.properties, newProperty] 
                }));
            };

            const removeProperty = (index) => {
                setFormData(prev => ({
                    ...prev,
                    properties: prev.properties.filter((_, i) => i !== index)
                }));
            };

            const handlePasteProperty = (index) => {
                setEditingPropertyIndex(index);
                setShowPasteModal(true);
            };

            const handleParsedData = (parsedData) => {
                if (editingPropertyIndex !== null) {
                    const updatedProperties = [...formData.properties];
                    updatedProperties[editingPropertyIndex] = {
                        ...updatedProperties[editingPropertyIndex],
                        name: parsedData.name,
                        address: parsedData.address,
                        area_sqm: parsedData.area_sqm,
                        area_pyeong: parsedData.area_pyeong,
                        rooms: parsedData.rooms,
                        bathrooms: parsedData.bathrooms,
                        direction: parsedData.direction,
                        building: parsedData.building,
                        floor: parsedData.floor,
                        totalFloor: parsedData.totalFloor,
                        rent: parsedData.rent,
                        contact: parsedData.contact,
                        contactType: parsedData.contactType,
                        agencyName: parsedData.agencyName,
                        notes: parsedData.notes ? parsedData.notes.split(',').map(n => n.trim()) : []
                    };
                    setFormData(prev => ({ ...prev, properties: updatedProperties }));
                }
                setEditingPropertyIndex(null);
            };

            const handleTakePhoto = (index) => {
                setPhotoPropertyIndex(index);
                setShowCamera(true);
            };

            const handlePhotoCapture = async (photoData) => {
                if (photoPropertyIndex !== null) {
                    const resizedPhoto = await PhotoManager.resizeImage(photoData);
                    const updatedProperties = [...formData.properties];
                    if (!updatedProperties[photoPropertyIndex].photos) {
                        updatedProperties[photoPropertyIndex].photos = [];
                    }
                    updatedProperties[photoPropertyIndex].photos.push({
                        id: Date.now().toString(),
                        data: resizedPhoto,
                        timestamp: new Date().toISOString()
                    });
                    setFormData(prev => ({ ...prev, properties: updatedProperties }));
                }
                setShowCamera(false);
                setPhotoPropertyIndex(null);
            };

            const handleDeletePhoto = (propertyIndex, photoId) => {
                const updatedProperties = [...formData.properties];
                updatedProperties[propertyIndex].photos = updatedProperties[propertyIndex].photos.filter(photo => photo.id !== photoId);
                setFormData(prev => ({ ...prev, properties: updatedProperties }));
            };

            const handleSave = () => {
                if (!formData.customerName.trim()) {
                    alert('Í≥†Í∞ùÎ™ÖÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                const validProperties = formData.properties.filter(p => p.name.trim());
                if (validProperties.length === 0) {
                    alert('ÏµúÏÜå ÌïòÎÇòÏùò Îß§Î¨º Ï†ïÎ≥¥Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }

                onSave({
                    ...formData,
                    properties: validProperties
                });
            };

            if (showCamera) {
                return <CameraView onCapture={handlePhotoCapture} onClose={() => setShowCamera(false)} />;
            }

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen">
                    <div className="flex items-center justify-between p-4 border-b border-gray-100">
                        <div className="flex items-center space-x-3">
                            <button onClick={onBack} className="text-blue-600 font-semibold text-lg">‚Üê</button>
                            <h1 className="font-semibold text-gray-800">
                                {meetingId === 'new' ? 'ÏÉà ÎØ∏ÌåÖ' : 'ÎØ∏ÌåÖ Ìé∏Ïßë'}
                            </h1>
                        </div>
                        <button onClick={handleSave} className="text-blue-600 font-medium">Ï†ÄÏû•</button>
                    </div>

                    <div className="p-4 space-y-6 pb-20">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-2">Í≥†Í∞ùÎ™Ö</label>
                            <input
                                type="text"
                                value={formData.customerName}
                                onChange={(e) => handleInputChange('customerName', e.target.value)}
                                className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                placeholder="Í≥†Í∞ùÎ™ÖÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî"
                            />
                        </div>

                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">ÎÇ†Ïßú</label>
                                <input
                                    type="date"
                                    value={formData.date}
                                    onChange={(e) => handleInputChange('date', e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">Î™©Ï†Å</label>
                                <select
                                    value={formData.purpose}
                                    onChange={(e) => handleInputChange('purpose', e.target.value)}
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                >
                                    <option value="Ï†ÑÏÑ∏">Ï†ÑÏÑ∏</option>
                                    <option value="ÏõîÏÑ∏">ÏõîÏÑ∏</option>
                                    <option value="Îß§Îß§">Îß§Îß§</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <div className="flex items-center justify-between mb-4">
                                <h3 className="text-lg font-medium text-gray-800">Îß§Î¨º Ï†ïÎ≥¥</h3>
                                <button
                                    onClick={addProperty}
                                    className="px-3 py-1 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700"
                                >
                                    + Îß§Î¨º Ï∂îÍ∞Ä
                                </button>
                            </div>

                            {formData.properties.map((property, index) => (
                                <div key={property.id} className="bg-gray-50 rounded-lg p-4 mb-4 border border-gray-100">
                                    <div className="flex items-center justify-between mb-3">
                                        <h4 className="font-medium text-gray-700">Îß§Î¨º {index + 1}</h4>
                                        <div className="flex space-x-2">
                                            <button
                                                onClick={() => handlePasteProperty(index)}
                                                className="text-blue-600 text-sm hover:underline"
                                            >
                                                üìã Î∂ôÏó¨ÎÑ£Í∏∞
                                            </button>
                                            <button
                                                onClick={() => handleTakePhoto(index)}
                                                className="text-green-600 text-sm hover:underline"
                                            >
                                                üì∑ Ï¥¨ÏòÅ
                                            </button>
                                            {formData.properties.length > 1 && (
                                                <button
                                                    onClick={() => removeProperty(index)}
                                                    className="text-red-500 text-sm hover:underline"
                                                >
                                                    ÏÇ≠Ï†ú
                                                </button>
                                            )}
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        <input
                                            type="text"
                                            placeholder="Îß§Î¨ºÎ™Ö"
                                            value={property.name}
                                            onChange={(e) => handlePropertyChange(index, 'name', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                        <input
                                            type="number"
                                            placeholder="ÌèâÏàò"
                                            value={property.area_pyeong}
                                            onChange={(e) => handlePropertyChange(index, 'area_pyeong', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                    </div>

                                    <input
                                        type="text"
                                        placeholder="Ï£ºÏÜå"
                                        value={property.address}
                                        onChange={(e) => handlePropertyChange(index, 'address', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm mb-3"
                                    />

                                    <div className="grid grid-cols-2 gap-3 mb-3">
                                        <input
                                            type="time"
                                            value={property.visitTime}
                                            onChange={(e) => handlePropertyChange(index, 'visitTime', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                        <input
                                            type="text"
                                            placeholder="Ïó∞ÎùΩÏ≤ò"
                                            value={property.contact}
                                            onChange={(e) => handlePropertyChange(index, 'contact', e.target.value)}
                                            className="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                                        />
                                    </div>

                                    <input
                                        type="text"
                                        placeholder="ÏûÑÎåÄÎ£å (Ïòà: Ï†ÑÏÑ∏ 5Ïñµ, ÏõîÏÑ∏ 200/70)"
                                        value={property.rent}
                                        onChange={(e) => handlePropertyChange(index, 'rent', e.target.value)}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm mb-3"
                                    />

                                    {/* ÌååÏã±Îêú Ï∂îÍ∞Ä Ï†ïÎ≥¥ ÌëúÏãú */}
                                    {(property.rooms || property.direction || property.building) && (
                                        <div className="p-2 bg-blue-50 rounded text-xs text-gray-600 mb-3">
                                            <div className="grid grid-cols-2 gap-2">
                                                {property.rooms && <span>Î∞© {property.rooms}Í∞ú</span>}
                                                {property.bathrooms && <span>ÏöïÏã§ {property.bathrooms}Í∞ú</span>}
                                                {property.direction && <span>{property.direction}</span>}
                                                {property.building && <span>{property.building}</span>}
                                                {property.floor && property.totalFloor && <span>{property.floor}/{property.totalFloor}</span>}
                                                {property.agencyName && <span>{property.agencyName}</span>}
                                            </div>
                                        </div>
                                    )}

                                    {/* ÏÇ¨ÏßÑ ÎØ∏Î¶¨Î≥¥Í∏∞ */}
                                    {property.photos && property.photos.length > 0 && (
                                        <div className="mt-3">
                                            <p className="text-sm font-medium text-gray-700 mb-2">Ï≤®Î∂ÄÎêú ÏÇ¨ÏßÑ</p>
                                            <div className="flex space-x-2 overflow-x-auto">
                                                {property.photos.map((photo) => (
                                                    <div key={photo.id} className="relative flex-shrink-0">
                                                        <img 
                                                            src={photo.data} 
                                                            alt="Îß§Î¨º ÏÇ¨ÏßÑ" 
                                                            className="photo-preview"
                                                        />
                                                        <button
                                                            onClick={() => handleDeletePhoto(index, photo.id)}
                                                            className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center"
                                                        >
                                                            ‚úï
                                                        </button>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    {showPasteModal && (
                        <PropertyPasteModal 
                            onClose={() => {
                                setShowPasteModal(false);
                                setEditingPropertyIndex(null);
                            }}
                            onParse={handleParsedData}
                        />
                    )}
                </div>
            );
        }

        // MeetingDetail Ïª¥Ìè¨ÎÑåÌä∏
        function MeetingDetail({ meetingId, meeting, onBack, onEdit, onUpdate, messageTemplates, onUpdateTemplates }) {
            const [showMessageModal, setShowMessageModal] = useState(false);
            const [showReportModal, setShowReportModal] = useState(false);
            const [editingProperty, setEditingProperty] = useState(null);
            const [propertyNotes, setPropertyNotes] = useState('');
            const [customerReaction, setCustomerReaction] = useState('');
            const [showCamera, setShowCamera] = useState(false);
            const [photoPropertyIndex, setPhotoPropertyIndex] = useState(null);
            const [selectedProperty, setSelectedProperty] = useState(null);

            if (!meeting) {
                return (
                    <div className="max-w-md mx-auto bg-white min-h-screen flex items-center justify-center">
                        <p className="text-gray-400">ÎØ∏ÌåÖÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§</p>
                    </div>
                );
            }

            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return `${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
            };

            const getStatusColor = (status) => {
                switch (status) {
                    case 'Î≥ºÏàòÏûàÏùå': return 'text-green-600';
                    case 'ÌôïÏù∏Ï§ë': return 'text-orange-500';
                    case 'Î≥¥Î•ò': return 'text-red-500';
                    case 'ÌôïÏù∏Ï†Ñ': return 'text-gray-500';
                    default: return 'text-gray-400';
                }
            };

            const handleCall = (phone) => {
                if (phone) {
                    window.location.href = `tel:${phone}`;
                }
            };

            const handleStatusChange = (propertyId, newStatus) => {
                const updatedMeeting = {
                    ...meeting,
                    properties: meeting.properties.map(prop =>
                        prop.id === propertyId ? { ...prop, status: newStatus } : prop
                    )
                };
                onUpdate(updatedMeeting);
            };

            const handleEditNotes = (property) => {
                setEditingProperty(property);
                setPropertyNotes(Array.isArray(property.notes) ? property.notes.join(', ') : property.notes || '');
                setCustomerReaction(property.customerReaction || '');
            };

            const handleSaveNotes = () => {
                if (editingProperty) {
                    const updatedMeeting = {
                        ...meeting,
                        properties: meeting.properties.map(prop =>
                            prop.id === editingProperty.id 
                                ? { 
                                    ...prop, 
                                    notes: propertyNotes.split(',').map(note => note.trim()).filter(note => note),
                                    customerReaction: customerReaction
                                } 
                                : prop
                        )
                    };
                    onUpdate(updatedMeeting);
                    setEditingProperty(null);
                    setPropertyNotes('');
                    setCustomerReaction('');
                }
            };

            const handleTakePhoto = (index) => {
                setPhotoPropertyIndex(index);
                setShowCamera(true);
            };

            const handlePhotoCapture = async (photoData) => {
                if (photoPropertyIndex !== null) {
                    const resizedPhoto = await PhotoManager.resizeImage(photoData);
                    const updatedMeeting = {
                        ...meeting,
                        properties: meeting.properties.map((prop, index) =>
                            index === photoPropertyIndex 
                                ? {
                                    ...prop,
                                    photos: [
                                        ...(prop.photos || []),
                                        {
                                            id: Date.now().toString(),
                                            data: resizedPhoto,
                                            timestamp: new Date().toISOString()
                                        }
                                    ]
                                }
                                : prop
                        )
                    };
                    onUpdate(updatedMeeting);
                }
                setShowCamera(false);
                setPhotoPropertyIndex(null);
            };

            const handleDeletePhoto = (propertyIndex, photoId) => {
                const updatedMeeting = {
                    ...meeting,
                    properties: meeting.properties.map((prop, index) =>
                        index === propertyIndex 
                            ? {
                                ...prop,
                                photos: prop.photos.filter(photo => photo.id !== photoId)
                            }
                            : prop
                    )
                };
                onUpdate(updatedMeeting);
            };

            if (showCamera) {
                return <CameraView onCapture={handlePhotoCapture} onClose={() => setShowCamera(false)} />;
            }

            return (
                <div className="max-w-md mx-auto bg-white min-h-screen">
                    <div className="flex items-center justify-between p-4 border-b border-gray-100">
                        <div className="flex items-center space-x-3">
                            <button onClick={onBack} className="text-blue-600 font-semibold text-lg">‚Üê</button>
                            <div>
                                <h1 className="font-semibold text-gray-800">{meeting.customerName}Îãò ÎØ∏ÌåÖ</h1>
                                <p className="text-sm text-gray-500">{formatDate(meeting.date)} ‚Ä¢ {meeting.purpose}</p>
                            </div>
                        </div>
                        <div className="flex space-x-2">
                            <button onClick={() => setShowMessageModal(true)} className="text-green-600 text-sm font-medium">Î¨∏Ïûê</button>
                            <button onClick={onEdit} className="text-blue-600 font-medium">Ìé∏Ïßë</button>
                        </div>
                    </div>

                    <div className="p-4 pb-20">
                        <h3 className="text-lg font-medium text-gray-800 mb-4">Îß§Î¨º Î™©Î°ù</h3>
                        <div className="space-y-2">
                            {meeting.properties.map((property, index) => (
                                <div 
                                    key={property.id} 
                                    className="bg-gray-50 rounded-lg p-3 border border-gray-100 cursor-pointer hover:bg-gray-100 transition-colors"
                                    onClick={() => setSelectedProperty(property)}
                                >
                                    <div className="flex items-center justify-between">
                                        <div className="flex-1">
                                            <p className="font-medium text-gray-800">
                                                {property.name} {property.area_pyeong}Ìèâ {property.address} {property.visitTime}
                                            </p>
                                            <div className="flex items-center space-x-2 mt-1">
                                                <span className={`px-2 py-1 text-xs rounded-full ${getStatusColor(property.status)} bg-opacity-10`}>
                                                    {property.status}
                                                </span>
                                                {property.photos && property.photos.length > 0 && (
                                                    <span className="text-xs text-blue-600">üì∑ {property.photos.length}Ïû•</span>
                                                )}
                                                {Array.isArray(property.notes) && property.notes.length > 0 && (
                                                    <span className="text-xs text-green-600">üìù Î©îÎ™®</span>
                                                )}
                                                {property.customerReaction && (
                                                    <span className="text-xs text-purple-600">üí¨ Î∞òÏùë</span>
                                                )}
                                            </div>
                                        </div>
                                        <button
                                            onClick={(e) => {
                                                e.stopPropagation();
                                                handleCall(property.contact);
                                            }}
                                            className="ml-3 px-2 py-1 bg-blue-600 text-white text-xs rounded hover:bg-blue-700"
                                        >
                                            üìû
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full max-w-md bg-white border-t border-gray-100 p-4">
                        <button 
                            onClick={() => setShowReportModal(true)}
                            className="w-full bg-blue-600 text-white py-3 rounded-lg font-medium hover:bg-blue-700"
                        >
                            Î≥¥Í≥†ÏÑú ÏÉùÏÑ±
                        </button>
                    </div>

                    {showMessageModal && (
                        <MessageModal 
                            onClose={() => setShowMessageModal(false)}
                            meeting={meeting}
                            templates={messageTemplates}
                        />
                    )}

                    {showReportModal && (
                        <ReportModal 
                            onClose={() => setShowReportModal(false)}
                            meeting={meeting}
                        />
                    )}

                    {editingProperty && (
                        <NotesModal 
                            property={editingProperty}
                            notes={propertyNotes}
                            reaction={customerReaction}
                            onNotesChange={setPropertyNotes}
                            onReactionChange={setCustomerReaction}
                            onSave={handleSaveNotes}
                            onClose={() => setEditingProperty(null)}
                        />
                    )}

                    {selectedProperty && (
                        <PropertyDetailModal 
                            property={selectedProperty}
                            meeting={meeting}
                            onClose={() => setSelectedProperty(null)}
                            onStatusChange={handleStatusChange}
                            onCall={handleCall}
                            onTakePhoto={handleTakePhoto}
                            onDeletePhoto={handleDeletePhoto}
                            onEditNotes={handleEditNotes}
                            getStatusColor={getStatusColor}
                        />
                    )}
                </div>
            );
        }

        // PropertyDetailModal Ïª¥Ìè¨ÎÑåÌä∏
        function PropertyDetailModal({ property, meeting, onClose, onStatusChange, onCall, onTakePhoto, onDeletePhoto, onEditNotes, getStatusColor }) {
            const propertyIndex = meeting.properties.findIndex(p => p.id === property.id);
            
            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-md max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">Îß§Î¨º ÏÉÅÏÑ∏Ï†ïÎ≥¥</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        
                        <div className="p-4 space-y-4">
                            {/* Í∏∞Î≥∏ Ï†ïÎ≥¥ */}
                            <div>
                                <h4 className="font-medium text-gray-800 text-lg mb-2">
                                    {property.name} {property.area_pyeong}Ìèâ
                                </h4>
                                <p className="text-gray-600 mb-1">{property.address}</p>
                                <p className="text-gray-600 mb-1">Î∞©Î¨∏ÏãúÍ∞Ñ: {property.visitTime}</p>
                                <p className="text-gray-600 mb-3">{property.rent}</p>
                            </div>

                            {/* ÏÉÅÏÑ∏ Ï†ïÎ≥¥ */}
                            {(property.rooms || property.direction || property.building) && (
                                <div className="bg-blue-50 rounded-lg p-3">
                                    <h5 className="font-medium text-gray-700 mb-2">ÏÉÅÏÑ∏Ï†ïÎ≥¥</h5>
                                    <div className="grid grid-cols-2 gap-2 text-sm">
                                        {property.rooms && <span>Î∞© {property.rooms}Í∞ú</span>}
                                        {property.bathrooms && <span>ÏöïÏã§ {property.bathrooms}Í∞ú</span>}
                                        {property.direction && <span>{property.direction}</span>}
                                        {property.building && <span>{property.building}</span>}
                                        {property.floor && property.totalFloor && <span>{property.floor}/{property.totalFloor}</span>}
                                        {property.agencyName && <span className="col-span-2">{property.agencyName}</span>}
                                    </div>
                                </div>
                            )}

                            {/* ÏÉÅÌÉú Î∞è Ïï°ÏÖò Î≤ÑÌäº */}
                            <div className="flex items-center justify-between">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-1">ÏÉÅÌÉú</label>
                                    <select
                                        value={property.status}
                                        onChange={(e) => onStatusChange(property.id, e.target.value)}
                                        className={`text-sm font-medium border border-gray-300 rounded px-2 py-1 ${getStatusColor(property.status)} focus:outline-none focus:ring-2 focus:ring-blue-500`}
                                    >
                                        <option value="ÌôïÏù∏Ï†Ñ">ÌôïÏù∏Ï†Ñ</option>
                                        <option value="ÌôïÏù∏Ï§ë">ÌôïÏù∏Ï§ë</option>
                                        <option value="Î≥ºÏàòÏûàÏùå">Î≥ºÏàòÏûàÏùå</option>
                                        <option value="Î≥¥Î•ò">Î≥¥Î•ò</option>
                                    </select>
                                </div>
                                <div className="flex space-x-2">
                                    <button
                                        onClick={() => onCall(property.contact)}
                                        className="px-3 py-2 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700"
                                    >
                                        üìû Ï†ÑÌôî
                                    </button>
                                    <button
                                        onClick={() => {
                                            onTakePhoto(propertyIndex);
                                            onClose();
                                        }}
                                        className="px-3 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700"
                                    >
                                        üì∑ Ï¥¨ÏòÅ
                                    </button>
                                </div>
                            </div>

                            {/* Ïó∞ÎùΩÏ≤ò Ï†ïÎ≥¥ */}
                            <div className="bg-gray-50 rounded-lg p-3">
                                <p className="text-sm text-gray-600">
                                    <span className="font-medium">{property.agencyName || property.contactType}:</span> {property.contact}
                                </p>
                            </div>

                            {/* ÏÇ¨ÏßÑ */}
                            {property.photos && property.photos.length > 0 && (
                                <div>
                                    <h5 className="font-medium text-gray-700 mb-2">Ï≤®Î∂ÄÎêú ÏÇ¨ÏßÑ ({property.photos.length}Ïû•)</h5>
                                    <div className="grid grid-cols-3 gap-2">
                                        {property.photos.map((photo) => (
                                            <div key={photo.id} className="relative">
                                                <img 
                                                    src={photo.data} 
                                                    alt="Îß§Î¨º ÏÇ¨ÏßÑ" 
                                                    className="w-full h-20 object-cover rounded cursor-pointer"
                                                    onClick={() => window.open(photo.data)}
                                                />
                                                <button
                                                    onClick={() => onDeletePhoto(propertyIndex, photo.id)}
                                                    className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white rounded-full text-xs flex items-center justify-center"
                                                >
                                                    ‚úï
                                                </button>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* ÌòÑÏû• Í∏∞Î°ù */}
                            <div>
                                <div className="flex items-center justify-between mb-2">
                                    <h5 className="font-medium text-gray-700">ÌòÑÏû• Í∏∞Î°ù</h5>
                                    <button
                                        onClick={() => {
                                            onEditNotes(property);
                                            onClose();
                                        }}
                                        className="text-blue-600 text-sm hover:underline"
                                    >
                                        Ìé∏Ïßë
                                    </button>
                                </div>
                                
                                {Array.isArray(property.notes) && property.notes.length > 0 && (
                                    <div className="mb-3">
                                        <p className="text-sm font-medium text-gray-600 mb-1">Î©îÎ™®</p>
                                        <div className="space-y-1">
                                            {property.notes.map((note, noteIndex) => (
                                                <p key={noteIndex} className="text-sm text-gray-800">‚Ä¢ {note}</p>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {property.customerReaction && (
                                    <div>
                                        <p className="text-sm font-medium text-gray-600 mb-1">Í≥†Í∞ù Î∞òÏùë</p>
                                        <p className="text-sm text-gray-800">{property.customerReaction}</p>
                                    </div>
                                )}
                                
                                {(!Array.isArray(property.notes) || property.notes.length === 0) && !property.customerReaction && (
                                    <p className="text-sm text-gray-400">ÌòÑÏû• Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</p>
                                )}
                            </div>
                        </div>
                        
                        <div className="p-4 border-t border-gray-100">
                            <button 
                                onClick={onClose}
                                className="w-full bg-gray-100 text-gray-700 py-2 rounded-md hover:bg-gray-200"
                            >
                                Îã´Í∏∞
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // MessageModal Ïª¥Ìè¨ÎÑåÌä∏
        function MessageModal({ onClose, meeting, templates }) {
            const handleSendMessage = (template) => {
                const message = template.message.replace('OOOÎ∂ÄÎèôÏÇ∞', 'ÎØ∏ÌåÖÎÖ∏Ìä∏Î∂ÄÎèôÏÇ∞');
                alert(`Î¨∏Ïûê Ï†ÑÏÜ°:\nÏàòÏã†: ${meeting.properties[0]?.contact}\nÎÇ¥Ïö©: ${message}`);
                onClose();
            };

            return (
                <div className="fixed inset-0 modal-backdrop flex items-end justify-center z-50">
                    <div className="bg-white rounded-t-lg w-full max-w-md max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">Î¨∏Ïûê ÌÖúÌîåÎ¶ø</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        <div className="p-4 space-y-3">
                            {templates.map(template => (
                                <div key={template.id} className="border border-gray-200 rounded-lg p-3">
                                    <h4 className="font-medium text-gray-800 mb-1">{template.name}</h4>
                                    <p className="text-sm text-gray-600 mb-3">{template.message}</p>
                                    <button 
                                        onClick={() => handleSendMessage(template)}
                                        className="w-full bg-green-600 text-white py-2 rounded-md text-sm hover:bg-green-700"
                                    >
                                        Ï†ÑÏÜ°
                                    </button>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // ReportModal Ïª¥Ìè¨ÎÑåÌä∏
        function ReportModal({ onClose, meeting }) {
            const formatDate = (dateString) => {
                const date = new Date(dateString);
                return `${date.getFullYear()}ÎÖÑ ${date.getMonth() + 1}Ïõî ${date.getDate()}Ïùº`;
            };

            const handleShare = () => {
                if (navigator.share) {
                    navigator.share({
                        title: `${meeting.customerName}Îãò ÎØ∏ÌåÖ Î≥¥Í≥†ÏÑú`,
                        text: `${formatDate(meeting.date)} ÎØ∏ÌåÖ Í≤∞Í≥ºÎ•º Í≥µÏú†Ìï©ÎãàÎã§.`
                    });
                } else {
                    alert('Î≥¥Í≥†ÏÑúÍ∞Ä Í∞§Îü¨Î¶¨Ïóê Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
                }
                onClose();
            };

            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-sm max-h-96 overflow-y-auto">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">Î≥¥Í≥†ÏÑú ÎØ∏Î¶¨Î≥¥Í∏∞</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        
                        <div className="p-4 bg-gray-50 text-sm">
                            <div className="bg-white p-3 rounded border text-center">
                                <h2 className="font-bold text-lg mb-3">ÎØ∏ÌåÖ Î≥¥Í≥†ÏÑú</h2>
                                <p className="text-gray-600 mb-4">
                                    {meeting.customerName}Îãò ‚Ä¢ {formatDate(meeting.date)}
                                </p>
                                
                                {meeting.properties.map((property, index) => (
                                    <div key={property.id} className="text-left mb-3 pb-3 border-b border-gray-100 last:border-b-0">
                                        <h4 className="font-semibold">{property.name} {property.area_pyeong}Ìèâ</h4>
                                        <p className="text-gray-600 text-xs">{property.address}</p>
                                        <p className="text-gray-600 text-xs">{property.rent}</p>
                                        
                                        {(property.rooms || property.direction) && (
                                            <p className="text-gray-600 text-xs">
                                                {property.rooms && `Î∞©${property.rooms}Í∞ú `}
                                                {property.bathrooms && `ÏöïÏã§${property.bathrooms}Í∞ú `}
                                                {property.direction && `${property.direction} `}
                                                {property.building && `${property.building} `}
                                                {property.floor && property.totalFloor && `${property.floor}/${property.totalFloor}`}
                                            </p>
                                        )}
                                        
                                        {Array.isArray(property.notes) && property.notes.length > 0 && (
                                            <div className="mt-2">
                                                <p className="text-xs font-medium">Î©îÎ™®:</p>
                                                {property.notes.map((note, i) => (
                                                    <p key={i} className="text-xs text-gray-700">‚Ä¢ {note}</p>
                                                ))}
                                            </div>
                                        )}
                                        
                                        {property.customerReaction && (
                                            <p className="text-xs mt-1">
                                                <span className="font-medium">Í≥†Í∞ù Î∞òÏùë:</span> {property.customerReaction}
                                            </p>
                                        )}

                                        {property.photos && property.photos.length > 0 && (
                                            <p className="text-xs mt-1 text-blue-600">
                                                üì∑ Ï≤®Î∂ÄÎêú ÏÇ¨ÏßÑ: {property.photos.length}Ïû•
                                            </p>
                                        )}
                                    </div>
                                ))}
                                
                                <p className="text-xs text-gray-500 mt-4">
                                    ÎØ∏ÌåÖÎÖ∏Ìä∏ Ïï±ÏúºÎ°ú ÏûëÏÑ±Îê®
                                </p>
                            </div>
                        </div>
                        
                        <div className="p-4 border-t border-gray-100">
                            <button 
                                onClick={handleShare}
                                className="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700"
                            >
                                Í≥µÏú†ÌïòÍ∏∞
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // NotesModal Ïª¥Ìè¨ÎÑåÌä∏
        function NotesModal({ property, notes, reaction, onNotesChange, onReactionChange, onSave, onClose }) {
            return (
                <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                    <div className="bg-white rounded-lg w-full max-w-sm">
                        <div className="flex items-center justify-between p-4 border-b border-gray-100">
                            <h3 className="text-lg font-semibold text-gray-800">ÌòÑÏû• Í∏∞Î°ù Ìé∏Ïßë</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-700">‚úï</button>
                        </div>
                        
                        <div className="p-4 space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Î©îÎ™® (ÏâºÌëúÎ°ú Íµ¨Î∂Ñ)
                                </label>
                                <textarea
                                    value={notes}
                                    onChange={(e) => onNotesChange(e.target.value)}
                                    placeholder="Ï±ÑÍ¥ë Ï¢ãÏùå, Î¶¨Î™®Îç∏ÎßÅ ÍπîÎÅîÌï®"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    rows="3"
                                />
                            </div>
                            
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-2">
                                    Í≥†Í∞ù Î∞òÏùë
                                </label>
                                <input
                                    type="text"
                                    value={reaction}
                                    onChange={(e) => onReactionChange(e.target.value)}
                                    placeholder="Îß§Ïö∞ ÎßåÏ°±, Í¥ÄÏã¨ ÏûàÏùå"
                                    className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                        </div>
                        
                        <div className="p-4 border-t border-gray-100 flex space-x-3">
                            <button 
                                onClick={onClose}
                                className="flex-1 py-2 border border-gray-300 rounded-md hover:bg-gray-50"
                            >
                                Ï∑®ÏÜå
                            </button>
                            <button 
                                onClick={onSave}
                                className="flex-1 bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700"
                            >
                                Ï†ÄÏû•
                            </button>
                        </div>
                    </div>
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>